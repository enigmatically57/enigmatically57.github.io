<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>DTMルートシミュレーター</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    padding: 30px; 
    background: #f0f0f0; 
    color: #333;
  }

  h2 { 
    font-size: 48px; 
    color: #007acc; 
    margin-bottom: 20px;
  }

  input, button { 
    font-size: 16px; 
    padding: 5px 10px; 
    margin: 5px 0;
  }

  button { 
    cursor: pointer;
    background-color: #007acc;
    color: #fff;
    border: none;
    border-radius: 5px;
  }

  #description {
    margin-bottom: 20px; 
    padding: 15px; 
    background-color: #e0f7fa; 
    border-left: 5px solid #007acc;
    font-size: 16px;
  }

  #rules {
    margin: 20px 0; 
    padding: 15px; 
    border: 2px solid #007acc; 
    background-color: #f1f8e9;
  }

  table { 
    border-collapse: collapse; 
    margin-top: 20px; 
    width: 100%; 
    background: #fff; 
    font-size: 16px;
  }

  th, td { 
    border: 1px solid #007acc; 
    padding: 8px; 
    text-align: center; 
  }

  th { 
    background-color: #007acc; 
    color: #fff;
  }

  #credits {
    margin-top: 30px; 
    font-size: 14px; 
    color: #555; 
    border-top: 1px dashed #aaa; 
    padding-top: 10px;
  }

  #output { max-width: 1200px; overflow-x: auto; }
</style>
</head>
<body>

<h2>DTMルートシミュレーター</h2>

<div id="description">
このシミュレーターでは、DTMer同士でプロジェクトを順番に渡すルートを生成します。<br><br>
<strong>使い方：</strong><br>
1. 人数を入力（2～20）<br>
2. 受け渡し回数を入力<br>
3. 「経路生成」ボタンを押す<br><br>
【表示例】 → D3 は、そのステップで D3 に渡すことを意味します。
</div>

<div id="rules">
<strong>ルール設定：</strong><br>
<label><input type="checkbox" id="ruleSelf" checked> 自分には渡さない</label><br>
<label><input type="checkbox" id="ruleUsed" checked> 過去に渡した人には渡さない</label><br>
<label><input type="checkbox" id="ruleStep" checked> 同じステップ内で同じ人には渡さない</label><br>
<label><input type="checkbox" id="rulePrev" checked> 直前のステップで渡した人には渡さない</label>
</div>

<div>
人数: <input type="number" id="numPeople" value="5" min="2" max="20">
受け渡し回数: <input type="number" id="steps" value="4" min="1">
<button id="generate">経路生成</button>
</div>

<div id="output"></div>

<div id="credits">
  <strong>クレジット</strong><br>
  設計: のとを<br>
  UIデザイン: ChatGPT
</div>

<script>
function generatePaths(n, steps) {
    const ruleSelf = document.getElementById("ruleSelf").checked;
    const ruleUsed = document.getElementById("ruleUsed").checked;
    const ruleStep = document.getElementById("ruleStep").checked;
    const rulePrev = document.getElementById("rulePrev").checked;

    let paths = Array.from({length:n}, ()=>[]);
    let used = Array.from({length:n}, ()=>new Set());

    for (let s=0; s<steps; s++) {
        let stepUsed = new Set();

        for (let i=0; i<n; i++) {
            let candidates = [];
            for (let j=0; j<n; j++) {
                let lastTarget = s > 0 ? paths[i][s-1] : -1;
                if ((ruleSelf ? j !== i : true) &&
                    (ruleUsed ? !used[i].has(j) : true) &&
                    (ruleStep ? !stepUsed.has(j) : true) &&
                    (rulePrev ? j !== lastTarget : true)) {
                    candidates.push(j);
                }
            }

            if (candidates.length === 0) {
                throw new Error("候補がありません。ルールを緩めてください。");
            }

            let target = candidates[Math.floor(Math.random() * candidates.length)];
            paths[i].push(target);
            if (ruleUsed) used[i].add(target);
            if (ruleStep) stepUsed.add(target);
        }
    }
    return paths;
}

function displayDTMerPaths(paths) {
    const output = document.getElementById("output");
    output.innerHTML = "";

    const n = paths.length;
    const steps = paths[0].length;

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headerRow.appendChild(document.createElement("th"));
    for (let s=0; s<steps; s++) {
        const th = document.createElement("th");
        th.textContent = "Step " + (s+1);
        headerRow.appendChild(th);
    }
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    for (let i=0; i<n; i++) {
        const row = document.createElement("tr");
        const th = document.createElement("th");
        th.textContent = "D" + (i+1);
        row.appendChild(th);

        for (let s=0; s<steps; s++) {
            const td = document.createElement("td");
            td.textContent = "→ D" + (paths[i][s]+1);
            row.appendChild(td);
        }

        tbody.appendChild(row);
    }
    table.appendChild(tbody);
    output.appendChild(table);
}

document.getElementById("generate").onclick = () => {
    const n = +document.getElementById("numPeople").value;
    const steps = +document.getElementById("steps").value;
    try {
        const paths = generatePaths(n, steps);
        displayDTMerPaths(paths);
    } catch(e) {
        alert(e.message);
        document.getElementById("output").innerHTML = "";
    }
};
</script>

</body>
</html>
